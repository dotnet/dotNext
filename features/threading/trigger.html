<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Asynchronous Trigger | .NEXT </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Asynchronous Trigger | .NEXT ">
    <meta name="generator" content="docfx 2.59.0.0">
    
    <link rel="shortcut icon" href="../../fav.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../doc_logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="asynchronous-trigger">Asynchronous Trigger</h1>

<p>.NEXT Threading Library offers a concept of asynchronous trigger for synchronization purposes. There are two types of triggers:</p>
<ul>
<li>Non-generic <a class="xref" href="../../api/DotNext.Threading.AsyncTrigger.html">AsyncTrigger</a> for producer-consumer scenario in asynchronous code</li>
<li>Generic <a class="xref" href="../../api/DotNext.Threading.AsyncTrigger-1.html">AsyncTrigger&lt;TState&gt;</a> for state coordination scenario in asynchronous code.</li>
</ul>
<h1 id="asynctrigger">AsyncTrigger</h1>
<p><a class="xref" href="../../api/DotNext.Threading.AsyncTrigger.html">AsyncTrigger</a> offers a simple synchronization for producer-consumer scenario:</p>
<ul>
<li>There is one or more suspended flows waiting for some event</li>
<li>There is one or more signaling flows</li>
</ul>
<p>The trigger offers the following methods for resuming and suspending the callers:</p>
<ul>
<li><code>Signal</code> method allows to resume one or more suspended callers</li>
<li><code>WaitAsync</code> suspends the caller until the call of <code>Signal</code></li>
<li><code>SignalAndWaitAsync</code> is an atomic combination of <code>Signal</code> and <code>WaitAsync</code> methods</li>
</ul>
<p>Signaling method behaves in two ways:</p>
<ul>
<li>Resume all suspended callers</li>
<li>Resume the first waiting caller in the queue</li>
</ul>
<p><code>AsyncTrigger</code> differs from <a class="xref" href="../../api/DotNext.Threading.AsyncAutoResetEvent.html">AsyncAutoResetEvent</a> synchronization primitive in the following aspects:</p>
<ul>
<li>There is no <em>signaled</em> state of the trigger. Therefore, any call to <code>WaitAsync</code> will be suspended and can be resumed only with <code>Signal</code> method</li>
<li>The trigger can resume all suspended callers</li>
<li><code>SignalAndWaitAsync</code> allows to build a queue of signaling flows</li>
</ul>
<h1 id="asynctriggertstate">AsyncTrigger&lt;TState&gt;</h1>
<p><a class="xref" href="../../api/DotNext.Threading.AsyncTrigger-1.html">AsyncTrigger&lt;TState&gt;</a> is the most general implementation of synchronization primitive compatible with asynchronous code. It can be used as a core for broad set of synchronization cases. The magic hides in ability to supply external state and predicate describing condition for resuming suspended callers. Each caller can supply its own condition for resuming and wait for signal. Signaling caller must supply the state that matches to one or more suspended callers. This concept is represented by the following methods:</p>
<ul>
<li><code>Signal</code> method and its overloads can be used to signal about changes in the state</li>
<li><code>WaitAsync</code> method and its overloads can be used to suspend the caller and specify the condition for resuming and the transition of the state</li>
</ul>
<p>As a result, this synchronization primitive can be used for building custom locks.</p>
<p>The following example demonstrates how to write a custom exclusive lock:</p>
<pre><code class="lang-csharp">using System.Runtime.CompilerServices;
using DotNext.Threading;

public sealed class MyExclusiveLock : AsyncTrigger&lt;StrongBox&lt;bool&gt;&gt;
{
    private sealed class LockManager : ITransition
    {
        internal static readonly LockManager Instance = new();

        // checks whether the lock can be acquired
        bool ITransition.Test(StrongBox&lt;bool&gt; state) =&gt; !state.Value;

        // turns the trigger into locked state
        void ITransition.Transit(StrongBox&lt;bool&gt; state) =&gt; state.Value = true;

        internal static void Release(StrongBox&lt;bool&gt; state) =&gt; state.Value = false;
    }

    public MyExclusiveLock()
        : base(new StrongBox&lt;bool&gt;(false))
    {
    }

    public ValueTask&lt;bool&gt; AcquireLockAsync(TimeSpan timeout, CancellationToken token)
      =&gt; WaitAsync(LockManager.Instance, timeout, token);

    public void ReleaseLock() =&gt; Signal(LockManager.Release);
}
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/dotNext/blob/gh-pages/docs/features/threading/trigger.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <div class="toggle-mode">
                <div class="icon">
                  <i aria-hidden="true">☀</i>
                </div>
                <label class="switch">
                  <input type="checkbox" id="switch-style">
                  <span class="slider round"></span>
                </label>
                <div class="icon">
                  <i aria-hidden="true">☾</i>
                </div>
              </div>
          
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <h5>In This Article</h5>
              <div></div>
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <div class="pull-left">
              Supported by the <a href="https://dotnetfoundation.org">.NET Foundation</a>
              
            </div>
            <div class="toggle-mode pull-right visible-sm visible-xs">
              <div class="icon">
                <i aria-hidden="true">☀</i>
              </div>
              <label class="switch">
                <input type="checkbox" id="switch-style-m">
                <span class="slider round"></span>
              </label>
              <div class="icon">
                <i aria-hidden="true">☾</i>
              </div>
            </div>
          </div>
        </div>
        <script type="text/javascript" src="../../styles/toggle-theme.js"></script>
      </footer>    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
