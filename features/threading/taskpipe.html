<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Task Completion Pipe | .NEXT </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Task Completion Pipe | .NEXT ">
    <meta name="generator" content="docfx ">
  
    <link rel="shortcut icon" href="../../fav.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
  
  
  
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../doc_logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="task-completion-pipe">Task Completion Pipe</h1>

<p><code>WhenAll</code> static method of <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.tasks.task">Task</a> waits until all passed tasks will be completed. Thus, the maximum possible execution time of such task is equal to the slowest task in the group. It means that there is no way to obtain results from the faster tasks in the group. From other side, <code>WhenAny</code> static method allows to obtain the result of the fastest task in the group. However, it doesn't allow to wait for all tasks. In some use cases, responsiveness of the program is a critical requirement so we need to have an ability to obtain and process tasks asynchronously as they complete.</p>
<p><a class="xref" href="../../api/DotNext.Threading.Tasks.TaskCompletionPipe-1.html">TaskCompletionPipe&lt;T&gt;</a> specially designed to process tasks as they complete using <a href="https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/tutorials/generate-consume-asynchronous-stream">asynchronous streams</a>. It provides the following API surface:</p>
<ul>
<li>Producer side:
<ul>
<li><code>Add</code> method to add asynchronous tasks</li>
<li><code>Complete</code> method to inform the pipe that newly tasks will not be added</li>
<li><code>Submit</code> method to add a group of tasks</li>
</ul>
</li>
<li>Consumer side:
<ul>
<li><a href="https://docs.microsoft.com/en-us/dotnet/api/system.collections.generic.iasyncenumerable-1">IAsyncEnumerable&lt;T&gt;</a> interface implementation allows to use <strong>await foreach</strong> statement in C# programming language to consume tasks asynchronously as they complete</li>
<li><code>TryRead</code> method attempts to obtain the completed task synchronously</li>
<li><code>WaitToReadAsync</code> allows to wait to the completed task submitted to the pipe. It should be used in combination with <code>TryRead</code> to optimize memory allocations by consumer</li>
</ul>
</li>
</ul>
<div class="NOTE">
<h5>Note</h5>
<p>Performance tip: <code>TryRead</code> and <code>WaitToReadAsync</code> methods are preferred way if consumer processes completed tasks slower than producer submits new tasks. Otherwise, <strong>await foreach</strong> is preferred.</p>
</div>
<p>The pipe is thread-safe for both consumer and producer. Moreover, multiple consumers and multiple producers are allowed, no need to specify configuration properties like <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.channels.channeloptions.singlereader">SingleReader</a> as for <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.channels.channel-1">Channel&lt;T&gt;</a> class.</p>
<p><a class="xref" href="../../api/DotNext.Threading.Tasks.TaskCompletionPipe.html">TaskCompletionPipe</a> static class exposes one-shot helper methods to obtain async stream over the tasks:</p>
<pre><code class="lang-csharp">Task&lt;int&gt; task1 = DoAsync();
Task&lt;int&gt; task2 = DoAsync();

int sum = 0;
await foreach (int result in TaskCompletionPipe.GetConsumer([task1, task2]))
{
    sum += result;
}
</code></pre>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/dotNext/blob/gh-pages/docs/features/threading/taskpipe.md/#L1" class="contribution-link">Edit this page</a>
                  </li>
                </ul>
              </div>
              <div class="toggle-mode">
                <div class="icon">
                  <i aria-hidden="true">☀</i>
                </div>
                <label class="switch">
                  <input type="checkbox" id="switch-style">
                  <span class="slider round"></span>
                </label>
                <div class="icon">
                  <i aria-hidden="true">☾</i>
                </div>
              </div>

              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <h5>In this article</h5>
              <div></div>
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <div class="pull-left">
        Supported by the <a href="https://dotnetfoundation.org">.NET Foundation</a>
        
            </div>
            <div class="toggle-mode pull-right visible-sm visible-xs">
              <div class="icon">
                <i aria-hidden="true">☀</i>
              </div>
              <label class="switch">
                <input type="checkbox" id="switch-style-m">
                <span class="slider round"></span>
              </label>
              <div class="icon">
                <i aria-hidden="true">☾</i>
              </div>
            </div>
          </div>
        </div>
        <script type="text/javascript" src="../../styles/toggle-theme.js"></script>
      </footer>    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
