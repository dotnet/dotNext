<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Cluster and Distributed Consensus | .NEXT </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Cluster and Distributed Consensus | .NEXT ">
    <meta name="generator" content="docfx 2.57.2.0">
    
    <link rel="shortcut icon" href="../../fav.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../doc_logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="cluster-and-distributed-consensus">Cluster and Distributed Consensus</h1>

<p>Cluster Computing is a form of distributed computing where each node set to perform the same task. The nodes usually located in the same local area network, each of them hosted on separated virtual machine or container. The input task can be distributed to the target node by load balancer or leader node. If leader node is required then cluster should use Distributed Consensus Algorithm to select exactly one leader or re-elect it if leader failed. Additionally, consensus-enabled cluster can be used to organize fault-tolerant set of microservices where only one service (leader) can be active and perform specific operations while other are in standby mode. If active node is failed then one of the standby nodes becomes active.</p>
<p>.NEXT cluster programming model provides the following features in addition to the core model:</p>
<ol>
<li>Messaging</li>
<li><a href="https://en.wikipedia.org/wiki/Replication_(computing)">Replication</a></li>
<li><a href="https://en.wikipedia.org/wiki/Consensus_(computer_science)">Consensus</a></li>
</ol>
<p>The programming model at higher level of abstraction is represented by interfaces:</p>
<ul>
<li><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster/IClusterMember">IClusterMember</a> represents individual node in the cluster</li>
<li><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster/ICluster">ICluster</a> represents entire cluster. This is an entry point to work with cluster using .NEXT library.</li>
<li><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster/IExpandableCluster">IExpandableCluster</a> optional interface that extends <code>ICluster</code> and represents dynamically configurable cluster where the nodes can be added or removed on-the-fly. If actual implementation doesn't support this interface then cluster can be configured only statically - it is required to shutdown entire cluster if you want to add or remove nodes</li>
<li><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Messaging/IMessageBus">IMessageBus</a> optional interface provides message-based communication between nodes in  point-to-point manner</li>
<li><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Replication/IReplicationCluster%601">IReplicationCluster&lt;T&gt;</a> optional interface represents a cluster where its state can be replicated across nodes to ensure consistency between them. Replication functionality based on <a class="xref" href="https://fuget.org/packages/DotNext.IO/3.1.0/lib/net5.0/DotNext.IO.dll/DotNext.IO.Log/IAuditTrail">IAuditTrail</a>. By default, design of replication infrastructure supports <a href="https://en.wikipedia.org/wiki/Weak_consistency">Weak Consistency</a>.</li>
</ul>
<p>Thereby, core model consists of two interfaces: <code>ICluster</code> and <code>IClusterMember</code>. Other interfaces are extensions of the core model.</p>
<h1 id="messaging">Messaging</h1>
<p>Messaging feature allows to organize point-to-point communication between nodes where individual node is able to send the message to any other node. The discrete unit of communication is represented by <a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Messaging/IMessage">IMessage</a> interface which is transport- and protocol-agnostic. The actual implementation should provide protocol-specific serialization and deserialization of such messages.</p>
<p>There are two types of messages:</p>
<ol>
<li><strong>Request-Reply</strong> message is similar to RPC call when caller should wait for the response. The response payload is represented by <code>IMessage</code></li>
<li><strong>One Way</strong> (or signal) message doesn't have response. It can be delivered in two ways:
1.1. With confirmation, when sender waiting for acknowledge from receiver side. As a result, it is possible to ensure that message is processed by receiver.
1.1. Without confirmation, when sender doesn't wait for acknowledge. Such kind of delivery is not reliable but very performant.</li>
</ol>
<p>The message can be transferred to the particular member using <a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Messaging/ISubscriber">ISubscriber</a> interface which is the extension of <code>IClusterMember</code> interface.</p>
<p>Usually, you don't to implement <code>IMessage</code> interface directly due to existence of ready-to-use realizations:</p>
<ol>
<li><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Messaging/BinaryMessage">BinaryMessage</a> for raw binary content</li>
<li><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Messaging/StreamMessage">StreamMessage</a> for message which payload is represented by <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.stream">Stream</a>. It it suitable for large payload when it is stored on the disk</li>
<li><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Messaging/TextMessage">TextMessage</a> for textual content</li>
<li><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Messaging/JsonMessage%601">JsonMessage&lt;T&gt;</a> for JSON-serializable types</li>
</ol>
<h1 id="distributed-consensus">Distributed Consensus</h1>
<p>Consensus Algorithm allows to achieve overall reliability in the presence of faulty nodes. The most commonly used consensus algorithms are:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Chandra%E2%80%93Toueg_consensus_algorithm">Chandra-Toueg consensus algorithm</a></li>
<li><a href="https://en.wikipedia.org/wiki/Paxos_(computer_science)">Paxos</a></li>
<li><a href="https://en.wikipedia.org/wiki/Raft_(computer_science)">Raft</a></li>
</ul>
<p>The consensus algorithm allows to choose exactly one leader node in the cluster.</p>
<p>.NEXT library provides protocol-agnostic implementation of Raft algorithm that can be adopted for any real network protocol. You can reuse this implementation which is located in <code>DotNext.Net.Cluster.Consensus.Raft</code> namespace. If you want to know more about Raft then use the following links:</p>
<ul>
<li><a href="https://raft.github.io/">The Raft Consensus Algorithm</a></li>
<li><a href="http://thesecretlivesofdata.com/">The Secret Lives of Data</a></li>
<li><a href="https://raft.github.io/raft.pdf">In Search of an Understandable Consensus Algorithm</a></li>
<li><a href="https://github.com/ongardie/dissertation">Dissertation</a></li>
</ul>
<h1 id="replication">Replication</h1>
<p>Replication allows to share information between nodes to ensure consistency between them. Usually, consensus algorithm covers replication process. In .NEXT library, replication functionality relies on the fact that each cluster node has its own persistent audit trail (or transaction log). However, the only default implementation of it is in-memory log which is suitable in siutations when your distributed application requires distributed consensus only and don't have distributed state that should be synchronized across cluster. If you need reliable replication then provide your own implementation of <a class="xref" href="https://fuget.org/packages/DotNext.IO/3.1.0/lib/net5.0/DotNext.IO.dll/DotNext.IO.Log/IAuditTrail%601">IAuditTrail&lt;T&gt;</a> interface or use <a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Consensus.Raft/PersistentState">PersistentState</a> class.</p>
<p><a class="xref" href="https://fuget.org/packages/DotNext.Net.Cluster/3.1.0/lib/net5.0/DotNext.Net.Cluster.dll/DotNext.Net.Cluster.Replication/IReplicationCluster">IReplicationCluster</a> interface indicates that the specific cluster implementation supports state replication across cluster nodes. It exposed access to the audit trail used to track local changes and commits on other cluster nodes.</p>
<h1 id="implementations">Implementations</h1>
<ul>
<li><a href="raft.html">.NEXT Raft Suite</a> is a fully-featured implementation of Raft algorithm and related infrastructure.</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/sakno/dotNext/blob/gh-pages/docs/features/cluster/index.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <div class="toggle-mode">
                <div class="icon">
                  <i aria-hidden="true">☀</i>
                </div>
                <label class="switch">
                  <input type="checkbox" id="switch-style">
                  <span class="slider round"></span>
                </label>
                <div class="icon">
                  <i aria-hidden="true">☾</i>
                </div>
                <script type="text/javascript" src="../../styles/toggle-theme.js"></script>
              </div>
          
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
