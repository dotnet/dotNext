<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Synchronization Enhancements | .NEXT </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Synchronization Enhancements | .NEXT ">
    <meta name="generator" content="docfx ">
  
    <link rel="shortcut icon" href="../../fav.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
  
  
  
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../doc_logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="synchronization-enhancements">Synchronization Enhancements</h1>

<p>.NET class library provides different ways to organize synchronized access to the resource shared between multiple threads. These synchronization mechanisms are have differences in their API and require to pay more attention to how to acquire and release resources. For example, <a href="https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/lock-statement">lock statement</a> can acquire and release resource in more safely way than <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.semaphoreslim">Semaphore</a> or <a href="https://docs.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim">ReaderWriterLock</a>. Last two synchronization mechanisms force the developer to use <strong>try-finally</strong> statement manually.</p>
<p>.NEXT provides unified representation of the resource lock using the following mechanisms:</p>
<ul>
<li>Monitor</li>
<li>Reader lock</li>
<li>Upgradeable lock</li>
<li>Writer lock</li>
<li>Semaphore</li>
</ul>
<p>This unification is implemented in the form of the single type <a class="xref" href="../../api/DotNext.Threading.Lock.html">Lock</a>. It exposes the same set of acquisition methods for each lock type described above. The acquired lock is represented by <a class="xref" href="../../api/DotNext.Threading.Lock.Holder.html">lock holder</a>. The only purpose of this object is to hold the acquired lock. The lock can be released using <code>Dispose</code> method of the holder.</p>
<pre><code class="lang-csharp">using DotNext.Threading;
using System.Threading;

using var semaphore = new SemaphoreSlim();
using var @lock = Lock.Semaphore(semaphore);
//acquires the lock
using (@lock.Acquire())
{
}

using var rwlock = new ReaderWriterLockSlim();
using var @lock = Lock.WriteLock(rwLock);
//acquires the writer lock
if (@lock.TryAcquire(out Lock.Holder holder))
    using (holder)
    {

    }
</code></pre>
<h1 id="built-in-readerwriter-synchronization">Built-in Reader/Writer Synchronization</h1>
<p>Exclusive lock such as monitor lock may not be applicable due to performance reasons for some data types. For example, exclusive lock for dictionary or list is redundant because there are two consumers of these objects: writers and readers.</p>
<p>DotNext library provides several extension methods for more granular control over synchronization of any reference type:</p>
<ul>
<li><code>AcquireReadLock</code> acquires reader lock</li>
<li><code>AcquireWriteLock</code> acquires exclusive lock</li>
<li><code>AcquireUpgradeableReadLock</code> acquires read lock which can be upgraded to write lock</li>
</ul>
<p>These methods allow to turn any thread-unsafe object into thread-safe object with precise control in context of multithreading access.</p>
<pre><code class="lang-csharp">using System.Text;
using DotNext.Threading;

var builder = new StringBuilder();

//reader
using (builder.AcquireReadLock())
{
    Console.WriteLine(builder.ToString());
}

//writer
using (builder.AcquireWriteLock())
{
    builder.Append(&quot;Hello, world!&quot;);
}
</code></pre>
<p>For more information check extension methods inside of <a class="xref" href="../../api/DotNext.Threading.LockAcquisition.html">LockAcquisition</a> class.</p>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/dotNext/blob/gh-pages/docs/features/core/sync.md/#L1" class="contribution-link">Edit this page</a>
                  </li>
                </ul>
              </div>
              <div class="toggle-mode">
                <div class="icon">
                  <i aria-hidden="true">☀</i>
                </div>
                <label class="switch">
                  <input type="checkbox" id="switch-style">
                  <span class="slider round"></span>
                </label>
                <div class="icon">
                  <i aria-hidden="true">☾</i>
                </div>
              </div>

              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <h5>In this article</h5>
              <div></div>
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <div class="pull-left">
        Supported by the <a href="https://dotnetfoundation.org">.NET Foundation</a>
        
            </div>
            <div class="toggle-mode pull-right visible-sm visible-xs">
              <div class="icon">
                <i aria-hidden="true">☀</i>
              </div>
              <label class="switch">
                <input type="checkbox" id="switch-style-m">
                <span class="slider round"></span>
              </label>
              <div class="icon">
                <i aria-hidden="true">☾</i>
              </div>
            </div>
          </div>
        </div>
        <script type="text/javascript" src="../../styles/toggle-theme.js"></script>
      </footer>    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
