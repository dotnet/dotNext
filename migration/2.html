<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Migration from 2.x | .NEXT </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Migration from 2.x | .NEXT ">
    <meta name="generator" content="docfx ">
  
    <link rel="shortcut icon" href="../fav.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
  
  
  
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../doc_logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">

        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="migration-from-2x">Migration from 2.x</h1>

<p>3.x is mostly compatible with 2.x. However, there are several minor and major incompatible changes in API surface.</p>
<h1 id="multiple-targets">Multiple Targets</h1>
<p>.NEXT provides multi-target build:</p>
<ul>
<li>.NET Standard 2.1</li>
<li>.NET Core 3.1 (only for <code>DotNext.AspNetCore.Cluster</code> library)</li>
<li>.NET 5</li>
</ul>
<p>All API provided by .NET Standard 2.1 build is available in .NET 5 build but not vice versa. Build for .NET 5 contains some extra types.</p>
<h1 id="incompatible-changes">Incompatible Changes</h1>
<h2 id="value-delegates">Value Delegates</h2>
<p>Value Delegates has been dropped from 3.x version due to the following reasons:</p>
<ul>
<li>C# 9 has support of function pointers at language level</li>
<li>Value delegate introduces another level of indirection</li>
<li>No way for the method relying on the value delegate to inline the actual method referenced by the instance of value delegate</li>
</ul>
<p>As a result, value delegates completely replaced by functional interfaces as described in <a href="https://github.com/dotnet/csharplang/issues/3452">this</a> proposal. This approach has many benefits:</p>
<ul>
<li>It can be used to represent function pointer and reference to the delegate instance without performance loss</li>
<li>There is no additional level of indirection</li>
<li>The method expecting implementation of functional interface has a chance to inline the actual implementation</li>
</ul>
<p>Functional intefaces are much verbose but very flexible. However, their complexity is hidden from the consumer of .NEXT libraries. All public APIs relying on value delegates replaced with the following overloaded methods:</p>
<ul>
<li>CLS-compliant version that expects an instance of regular delegate</li>
<li>Unsafe version that expects function pointer of specific signature</li>
</ul>
<h2 id="augmented-compilation">Augmented Compilation</h2>
<p><code>DotNext.Augmentation.Fody</code> was introduced to obtain value delegates from function pointers in C# 8. Now it's not needed because C# 9 has syntax for function pointers.</p>
<h2 id="write-ahead-log">Write-Ahead Log</h2>
<p>Some methods of <code>IAuditTrail&lt;TEntry&gt;</code> interface refactored to simplify their signature. For example, <code>ReadAsync</code> method now doesn't accept log entry consumer as a generic parameter.</p>
<h2 id="obsolete-members-and-classes">Obsolete Members and Classes</h2>
<p>All obsolete members and classes in 2.x has been removed.</p>
<h2 id="arrayrentalt">ArrayRental&lt;T&gt;</h2>
<p><code>ArrayRental&lt;T&gt;</code> type has been replaced with <code>MemoryOwner&lt;T&gt;</code> type.</p>
<h2 id="dynamicinvoker">DynamicInvoker</h2>
<p><code>DynamicInvoker</code> delegate now uses <a href="https://docs.microsoft.com/en-us/dotnet/api/system.span-1">Span&lt;T&gt;</a> as a container for variadic arguments instead of array to avoid memory allocation in reflection scenarios.</p>
<h2 id="buffers">Buffers</h2>
<p><code>BufferWriterSlim&lt;T&gt;</code> always copies initial buffer to the rented buffer on overflow.</p>
<p><code>MemoryWriter&lt;T&gt;</code> has been renamed to <code>BufferWriter&lt;T&gt;</code>.</p>
<h2 id="boxt">Box&lt;T&gt;</h2>
<p><code>Box&lt;T&gt;</code> moved from <code>DotNext.Runtime.CompilerServices</code> to <code>DotNext.Runtime</code> namespace.</p>
<h2 id="enummember-api">EnumMember API</h2>
<p><code>Enum&lt;T&gt;</code> type providing EnumMember API has been removed. .NET 5 provides all necessary static methods of <a href="https://docs.microsoft.com/en-us/dotnet/api/system.enum">Enum</a> class. Methods for obtaining attributes have been moved to <code>DotNext.Reflection.EnumType</code> type.</p>

</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/dotNext/blob/gh-pages/docs/migration/2.md/#L1" class="contribution-link">Edit this page</a>
                  </li>
                </ul>
              </div>
              <div class="toggle-mode">
                <div class="icon">
                  <i aria-hidden="true">☀</i>
                </div>
                <label class="switch">
                  <input type="checkbox" id="switch-style">
                  <span class="slider round"></span>
                </label>
                <div class="icon">
                  <i aria-hidden="true">☾</i>
                </div>
              </div>

              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <h5>In this article</h5>
              <div></div>
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <div class="pull-left">
        Supported by the <a href="https://dotnetfoundation.org">.NET Foundation</a>
        
            </div>
            <div class="toggle-mode pull-right visible-sm visible-xs">
              <div class="icon">
                <i aria-hidden="true">☀</i>
              </div>
              <label class="switch">
                <input type="checkbox" id="switch-style-m">
                <span class="slider round"></span>
              </label>
              <div class="icon">
                <i aria-hidden="true">☾</i>
              </div>
            </div>
          </div>
        </div>
        <script type="text/javascript" src="../styles/toggle-theme.js"></script>
      </footer>    </div>

    <script type="text/javascript" src="../styles/docfx.vendor.min.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
